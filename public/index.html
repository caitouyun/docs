<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>菜头云 - 简单的前端部署</title>
<meta property="og:title" content="菜头云 - 简单的前端部署">
<meta name="description" content="菜头云是一个简单的帮助开发者快速迭代和部署前端静态网站的服务">
<meta property="og:description" content="菜头云是一个简单的帮助开发者快速迭代和部署前端静态网站的服务">
</head>
<body><h1>
<a id="user-content-菜头云" class="anchor" href="#%E8%8F%9C%E5%A4%B4%E4%BA%91" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>菜头云</h1>
<p>菜头云 (<a href="https://caitouyun.com" rel="nofollow">https://caitouyun.com</a>) 是一个简单的帮助开发者快速迭代和部署前端静态网站的服务</p>
<ul>
<li><a href="https://github.com/caitouyun/docs/issues">如果在使用中遇到问题请前往提交 issue</a></li>
<li><a href="https://github.com/caitouyun/docs/discussions">相关功能讨论请点击前往讨论区</a></li>
</ul>
<h2>
<a id="user-content-目录" class="anchor" href="#%E7%9B%AE%E5%BD%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>目录</h2>
<ul>
<li><a href="#%E5%AE%89%E8%A3%85">安装</a></li>
<li><a href="#%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95">账号登录</a></li>
<li>
<a href="#%E9%83%A8%E7%BD%B2">部署</a>
<ul>
<li><a href="#%E7%BD%91%E7%AB%99%E5%90%8D">网站名</a></li>
<li><a href="#%E9%A2%84%E8%A7%88%E7%8E%AF%E5%A2%83">预览环境</a></li>
<li><a href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83">生产环境</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-caitouyml">使用 caitou.yml</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D">自定义域名</a></li>
<li><a href="#%E8%87%AA%E5%8A%A8%E8%B7%B3%E8%BD%AC-https">自动跳转 https</a></li>
<li><a href="#%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8-single-page-application">单页面应用 (Single Page Application)</a></li>
<li><a href="#%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83">集成环境</a></li>
<li><a href="#github-actions">Github Actions</a></li>
</ul>
</li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-faq">常见问题 FAQ</a></li>
</ul>
<h2>
<a id="user-content-安装" class="anchor" href="#%E5%AE%89%E8%A3%85" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>安装</h2>
<div class="highlight highlight-source-shell"><pre>curl -sf https://cli.caitouyun.com/install.sh <span class="pl-k">|</span> sh</pre></div>
<h2>
<a id="user-content-账号登录" class="anchor" href="#%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>账号登录</h2>
<p>使用菜头云部署需要一个注册账号, 运行</p>
<div class="highlight highlight-source-shell"><pre>caitou login</pre></div>
<p>浏览器中会打开一个网页链接，如果没有登录网页版可以先使用 Github 账号登录 (目前只支持 Github 账号登录)，在注册或者登录成功后会返回一个授权页面，点击确认之后可以窗口会自动关闭，同时终端会显示 <code>登录成功</code></p>
<p>登录成功之后可以使用</p>
<div class="highlight highlight-source-shell"><pre>caitou whoami</pre></div>
<p>如果成功输出了个人的账号信息则表示在终端已经登录成功</p>
<h2>
<a id="user-content-部署" class="anchor" href="#%E9%83%A8%E7%BD%B2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>部署</h2>
<h3>
<a id="user-content-网站名" class="anchor" href="#%E7%BD%91%E7%AB%99%E5%90%8D" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>网站名</h3>
<ul>
<li>每个菜头云网站都有唯一的网站名</li>
<li>网站名只能包括数字和字母以及<code>-</code>
</li>
<li>网站在部署的时候会自动创建，如果是别人已经使用的网站名会返回部署失败</li>
<li>比如 demo 这个网站的生产环境将自动部署到以下子域名
<ul>
<li>海外生产环境 <a href="https://demo.caitou.org" rel="nofollow">https://demo.caitou.org</a>
</li>
<li>大陆生产环境 <a href="https://demo.caitouyun.com" rel="nofollow">https://demo.caitouyun.com</a>
</li>
</ul>
</li>
</ul>
<h3>
<a id="user-content-预览环境" class="anchor" href="#%E9%A2%84%E8%A7%88%E7%8E%AF%E5%A2%83" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>预览环境</h3>
<p>我们部署的项目在 <a href="https://github.com/caitouyun/demo">caitouyun/demo</a></p>
<p>我们假设当前目录为 demo,要部署的目录为 www, www 中包含了要部署的静态网站, 我们在 demo 目录中运行:</p>
<div class="highlight highlight-source-shell"><pre>caitou deploy --site demo --public www <span class="pl-c"><span class="pl-c">#</span> 需要将demo替换为你自己选择的网站名</span></pre></div>
<p>会将目录文件上传后，返回两个网站预览地址</p>
<ul>
<li>
<a href="https://demo-5c4992f8.caitouyun.com" rel="nofollow">https://demo-5c4992f8.caitouyun.com</a>
<ul>
<li>为中国大陆服务器地址，默认无法直接访问（内部已经验证的网站除外）</li>
</ul>
</li>
<li>
<a href="https://demo-5c4992f8.caitou.org" rel="nofollow">https://demo-5c4992f8.caitou.org</a>
<ul>
<li>海外服务器地址, 可以直接访问</li>
</ul>
</li>
<li>可以看到这次部署的子域名为 <code>demo-5c4992f8</code>，由网站 id 和一串唯一的字符串组成，代表了这次部署的链接</li>
</ul>
<p>你可以修改本地文件之后重新运行 <code>caitou deploy --site demo --public www</code> 来获得最新版本的预览链接</p>
<h3>
<a id="user-content-生产环境" class="anchor" href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>生产环境</h3>
<p>如果需要部署生产环境，可以运行</p>
<div class="highlight highlight-source-shell"><pre>caitou deploy --site demo --public www --production</pre></div>
<p>将会将本地当前版本部署到</p>
<ul>
<li><a href="https://demo.caitouyun.com" rel="nofollow">https://demo.caitouyun.com</a></li>
<li><a href="https://demo.caitou.org" rel="nofollow">https://demo.caitou.org</a></li>
</ul>
<p>两个镜像站点，访问和预览同样收到限制，但是 <a href="https://demo.caitouyun.com" rel="nofollow">https://demo.caitouyun.com</a> (国内镜像) 可以通过绑定一个备案过的域名访问</p>
<h3>
<a id="user-content-使用-caitouyml" class="anchor" href="#%E4%BD%BF%E7%94%A8-caitouyml" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>使用 <code>caitou.yml</code>
</h3>
<p>自定义域名通过本地文件 <code>demo/caitou.yml</code> 来配置，在这之前我们先定义部署网站名<code>site</code>和部署目录 <code>www</code></p>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">site</span>: <span class="pl-s">demo</span>
<span class="pl-ent">public</span>: <span class="pl-s">www</span></pre></div>
<p>这样在 demo 目录中就可以直接使用 <code>caitou deploy</code> 来部署预览链接以及 <code>caitou deploy --production</code>部署生产环境</p>
<h3>
<a id="user-content-自定义域名" class="anchor" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>自定义域名</h3>
<p>在设定好<code>caitou.yml</code>之后可以通过 <code>domains</code> 下的 <code>china</code> 和 <code>global</code> 来分别对大陆镜像和海外镜像绑定自定义域名，两个都是可选配置</p>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">domains</span>:
  <span class="pl-ent">china</span>: <span class="pl-s">www.yourwesite.cn</span>
  <span class="pl-ent">global</span>: <span class="pl-s">www.yourwebsite.com</span></pre></div>
<p>绑定域名目前只支持 CNAME 的模式，比如以上配置就需要在 DNS 服务商中:</p>
<ul>
<li>将 <a href="http://www.yourwesite.cn" rel="nofollow">www.yourwesite.cn</a> 指向 demo.caitouyun.com</li>
<li>将 <a href="http://www.yourwesite.com" rel="nofollow">www.yourwesite.com</a> 指向 demo.caitou.org</li>
</ul>
<p>配置好之后需要等待 DNS 服务器在全球更新，在本地可以通过运行命令 <code>dig CNAME www.yourwesite.cn</code> 来查看是否已经更新</p>
<p>我们使用 <a href="https://letsencrypt.org/" rel="nofollow">Let's Encrypt</a> 给自定义域名自动配置 SSL 证书</p>
<h3>
<a id="user-content-自动跳转-https" class="anchor" href="#%E8%87%AA%E5%8A%A8%E8%B7%B3%E8%BD%AC-https" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>自动跳转 https</h3>
<p>在 <code>caitou.yml</code> 中 添加 <code>force_ssl: true</code> 之后访问所有的访问将自动跳转到 https</p>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">site</span>: <span class="pl-s">demo</span>
<span class="pl-ent">public</span>: <span class="pl-s">www</span>
<span class="pl-ent">force_ssl</span>: <span class="pl-c1">true</span></pre></div>
<h3>
<a id="user-content-单页面应用-single-page-application" class="anchor" href="#%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8-single-page-application" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>单页面应用 (Single Page Application)</h3>
<p>菜头云支持自定义路由规则，可以很方面的支持单页面应用(Single Page Application),在<code>caitou.yml</code>中添加以下<code>rewrites</code>规则就可以将请求重写到 <code>/index.html</code> 来指出前端单页面应用</p>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">rewrites</span>:
  - <span class="pl-ent">source</span>: <span class="pl-s"><span class="pl-pds">'</span>**<span class="pl-pds">'</span></span>
    <span class="pl-ent">destination</span>: <span class="pl-s">/index.html</span></pre></div>
<p>详细的 <code>rewrites</code> 文档正在补充中...</p>
<h3>
<a id="user-content-集成环境" class="anchor" href="#%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>集成环境</h3>
<p>将<code>caitou</code> 集成到现有的<code>git</code>集成部署环境中也是非常简单，使用 <code>caitou deploy --git</code> 会自动读取本地或者环境中的 git 信息来判断是预览环境还是生产环境，我们目前默认 <code>master</code> 的部署为生产环境部署</p>
<div class="highlight highlight-source-shell"><pre>caitou deploy --git</pre></div>
<p>我们以 Github Action 为例，如果你有其他平台的集成，请在讨论区中提出，我们会添加到文档中</p>
<h3>
<a id="user-content-github-actions" class="anchor" href="#github-actions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Github Actions</h3>
<p>我们推荐使用官方的 <a href="https://github.com/caitouyun/action">菜头云 Github Action</a>，</p>
<p>添加<code>CAITOU_TOKEN</code>环境变量，可以在本地登录之后运行</p>
<div class="highlight highlight-source-shell"><pre>caitou token</pre></div>
<p>将终端输出的 token 作为<code>CAITOU_TOKEN</code>变量复制到 github 项目中</p>
<p><a href="public/github-caitou-token.png" target="_blank" rel="noopener noreferrer"><img src="public/github-caitou-token.png" alt="" style="max-width:100%;"></a></p>
<p>创建目录 <code>.github/workflows</code> 并添加一个 <code>caitouyun.yaml</code> 文件</p>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">name</span>: <span class="pl-s">caitouyun</span>
<span class="pl-ent">on</span>:
  <span class="pl-ent">push</span>:
    <span class="pl-ent">branches</span>: <span class="pl-s">[master]</span>
<span class="pl-ent">jobs</span>:
  <span class="pl-ent">build</span>:
    <span class="pl-ent">runs-on</span>: <span class="pl-s">ubuntu-latest</span>
    <span class="pl-ent">steps</span>:
      - <span class="pl-ent">uses</span>: <span class="pl-s">actions/checkout@v2</span>
      - <span class="pl-ent">uses</span>: <span class="pl-s">caitouyun/action@master</span>
        <span class="pl-ent">with</span>:
          <span class="pl-ent">args</span>: <span class="pl-s">caitou deploy --git</span>
        <span class="pl-ent">env</span>:
          <span class="pl-ent">CAITOU_TOKEN</span>: <span class="pl-s">${{ secrets.CAITOU_TOKEN }}</span></pre></div>
<p>如果需要其他的步骤，比如<code>npm install</code>也可以在部署之前添加，更多配置可以查看 <a href="https://docs.github.com/actions">Github Action 官方文档</a> 或在讨论区中询问</p>
<h2>
<a id="user-content-常见问题-faq" class="anchor" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-faq" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>常见问题 FAQ</h2>
</body>
</html>
